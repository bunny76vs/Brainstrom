<script>
    const params = new URLSearchParams(window.location.search);
    const stream = params.get("stream");
    const percentage = params.get("percentage");

    const courseSelect = document.getElementById("courseSelect");
    const collegeResult = document.getElementById("collegeResult");

    // ---------------- LOAD COURSES ----------------
    fetch(`/api/courses/${stream}`)
        .then(res => res.json())
        .then(courses => {
            console.log("Courses:", courses); // debug

            courseSelect.innerHTML = '<option value="">Select Course</option>';

            if (!Array.isArray(courses) || courses.length === 0) {
                courseSelect.innerHTML = '<option>No courses found</option>';
                return;
            }

            courses.forEach(item => {
                // âœ… CORRECT FIELD
                const option = document.createElement("option");
                option.value = item.name;
                option.textContent = item.name;
                courseSelect.appendChild(option);
            });
        })
        .catch(err => {
            console.error("Course Load Error:", err);
            courseSelect.innerHTML = '<option>Error loading courses</option>';
        });

    // ---------------- LOAD COLLEGES ----------------
    courseSelect.addEventListener("change", function () {
        const selectedCourse = this.value;
        if (!selectedCourse) return;

        fetch("/api/recommend", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                course: selectedCourse,
                percentage: percentage
            })
        })
        .then(res => res.json())
        .then(colleges => {
            if (!Array.isArray(colleges) || colleges.length === 0) {
                collegeResult.innerHTML =
                    "<p>No colleges found for this selection.</p>";
                return;
            }

            let html = `
                <table>
                    <tr>
                        <th>College Name</th>
                        <th>Course</th>
                        <th>Minimum %</th>
                    </tr>
            `;

            colleges.forEach(c => {
                html += `
                    <tr>
                        <td>${c.college_name}</td>
                        <td>${c.course}</td>
                        <td>${c.min_percentage}</td>
                    </tr>
                `;
            });

            html += "</table>";
            collegeResult.innerHTML = html;
        })
        .catch(err => {
            console.error("College Load Error:", err);
            collegeResult.innerHTML = "<p>Error loading colleges.</p>";
        });
    });
</script>
